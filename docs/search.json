[
  {
    "objectID": "assignment21.html",
    "href": "assignment21.html",
    "title": "Daily Assignment 21",
    "section": "",
    "text": "library(tidyverse)\n\nWarning: package 'purrr' was built under R version 4.4.3\n\n\nWarning: package 'dplyr' was built under R version 4.4.3\n\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(dataRetrieval)\n\nWarning: package 'dataRetrieval' was built under R version 4.4.3\n\nlibrary(zoo)\n\nWarning: package 'zoo' was built under R version 4.4.3\n\n\n\nAttaching package: 'zoo'\n\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n\nlibrary(tsibble)\n\nWarning: package 'tsibble' was built under R version 4.4.3\n\n\nRegistered S3 method overwritten by 'tsibble':\n  method               from \n  as_tibble.grouped_df dplyr\n\nAttaching package: 'tsibble'\n\nThe following object is masked from 'package:zoo':\n\n    index\n\nThe following object is masked from 'package:lubridate':\n\n    interval\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, union\n\nlibrary(ggplot2)\nlibrary(feasts)\n\nWarning: package 'feasts' was built under R version 4.4.3\n\n\nLoading required package: fabletools\n\n\nWarning: package 'fabletools' was built under R version 4.4.3\n\nlibrary(fabletools)\nlibrary(tsibble)\nlibrary(rsample)\n\nWarning: package 'rsample' was built under R version 4.4.3\n\nlibrary(recipes)\n\nWarning: package 'recipes' was built under R version 4.4.3\n\n\n\nAttaching package: 'recipes'\n\nThe following object is masked from 'package:stringr':\n\n    fixed\n\nThe following object is masked from 'package:stats':\n\n    step\n\nlibrary(parsnip)\n\nWarning: package 'parsnip' was built under R version 4.4.3\n\n\n\nAttaching package: 'parsnip'\n\nThe following object is masked from 'package:fabletools':\n\n    null_model\n\nlibrary(purrr)\nlibrary(modeltime)\n\nWarning: package 'modeltime' was built under R version 4.4.3\n\n\n\n# Example: Cache la Poudre River at Mouth (USGS site 06752260)\npoudre_flow &lt;- readNWISdv(siteNumber = \"06752260\",    # Download data from USGS for site 06752260\n                          parameterCd = \"00060\",      # Parameter code 00060 = discharge in cfs)\n                          startDate = \"2013-01-01\",   # Set the start date\n                          endDate = \"2023-12-31\") |&gt;  # Set the end date\n  renameNWISColumns() |&gt;                              # Rename columns to standard names (e.g., \"Flow\", \"Date\")\n  mutate(Date = yearmonth(Date)) |&gt;                   # Convert daily Date values into a year-month format (e.g., \"2023 Jan\")\n  group_by(Date) |&gt;                                   # Group the data by the new monthly Date\n  summarise(Flow = mean(Flow))                       # Calculate the average daily flow for each month\n\nGET:https://waterservices.usgs.gov/nwis/dv/?site=06752260&format=waterml%2C1.1&ParameterCd=00060&StatCd=00003&startDT=2013-01-01&endDT=2023-12-31\n\n\n\nas_tsibble(poudre_flow) %&gt;%\n  gg_subseries() + \n  labs(title = \"Monthly Streamflow Patterns\", y = \"Flow (cfs)\", x = \"Year\") + \n  theme_minimal()\n\nUsing `Date` as index variable.\nPlot variable not specified, automatically selected `y = Flow`\n\n\n\n\n\n\n\n\n\nIn this model, streamflow peaks around May and June, with an odd peak exhibited in early September. The season is the year and the subseries, aka the months, make up it.\n\npoudre_flow$Date &lt;- as.Date(poudre_flow$Date)\n\n\nflow_ts &lt;- ts(poudre_flow$Flow, start = c(2013, 1), frequency = 12)\n\n\nstl_decomp &lt;- stl(flow_ts, s.window = \"periodic\")\n\n\nplot(stl_decomp)\n\n\n\n\n\n\n\n\nThe trend (referring to the measurement of the river’s “memory”) peaks at around 2015, but declines later on and remains relatively consistent after 2018. The seasonal data (the measurement of regular, periodic fluctuations in data) spikes at relatively consistent intervals around halfway through each year.\nAssignment 22 Begins Below\n\nsplit &lt;- initial_time_split(data = poudre_flow, prop = 0.8)\n#the command \"time_series_split\" doesn't actually exist FYI\n\ntraining &lt;- training(split)\ntesting &lt;- testing(split)\n\n\narima_reg &lt;- arima_reg() %&gt;%\n  set_engine(\"auto_arima\")\n\nprophet_reg &lt;- prophet_reg() %&gt;%\n  set_engine(\"prophet\")\n\n\nmods &lt;- list(arima_reg, prophet_reg)\n\n\nmodels &lt;- map(mods, ~ fit(.x, Flow ~ Date, data = training))\n\nfrequency = 12 observations per 1 year\n\n\nDisabling weekly seasonality. Run prophet with weekly.seasonality=TRUE to override this.\n\n\nDisabling daily seasonality. Run prophet with daily.seasonality=TRUE to override this.\n\n\n\nmodels_tbl &lt;- as_modeltime_table(models)\n\ncalibration_table &lt;- modeltime_calibrate(models_tbl, testing, quiet = FALSE)\n\n\npoudre_flow &lt;- poudre_flow %&gt;%\n  mutate(Date = as.Date(Date))\n\n\ntesting &lt;- testing %&gt;%\n  mutate(Date = as.Date(Date))\n\n\nforecast_tbl &lt;- models_tbl %&gt;%\n  modeltime_forecast(\n    h = \"12 months\",\n    actual_data = poudre_flow\n  )\n\n\nforecast_tbl %&gt;%\n  plot_modeltime_forecast(.interactive = FALSE)\n\nWarning: ✖ Expecting the following names to be in the data frame: .conf_hi, .conf_lo.\nℹ Proceeding with '.conf_interval_show = FALSE' to visualize the forecast without confidence intervals.\nAlternatively, try using `modeltime_calibrate()` before forecasting to add confidence intervals.\n\n\n\n\n\n\n\n\n\n\nfuture_poudre_flow &lt;- readNWISdv(siteNumber = \"06752260\",    # Download data from USGS for site 06752260\n                          parameterCd = \"00060\",      # Parameter code 00060 = discharge in cfs)\n                          startDate = \"2024-01-01\",   # Set the start date\n                          endDate = \"2025-01-01\") %&gt;% # Set the end date\n  renameNWISColumns() %&gt;%                              # Rename columns to standard names (e.g., \"Flow\", \"Date\")\n  mutate(Date = yearmonth(Date)) %&gt;%                   # Convert daily Date values into a year-month format (e.g., \"2023 Jan\")\n  group_by(Date) %&gt;%                      # Group the data by the new monthly Date\n  summarise(Flow = mean(Flow))                       # Calculate the average daily flow for each month\n\nGET:https://waterservices.usgs.gov/nwis/dv/?site=06752260&format=waterml%2C1.1&ParameterCd=00060&StatCd=00003&startDT=2024-01-01&endDT=2025-01-01\n\n\n\nas_tsibble(future_poudre_flow) %&gt;%\n  gg_subseries() + \n  labs(title = \"Monthly Streamflow Patterns\", y = \"Flow (cfs)\", x = \"Month\") + \n  theme_minimal()\n\nUsing `Date` as index variable.\nPlot variable not specified, automatically selected `y = Flow`\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?"
  }
]